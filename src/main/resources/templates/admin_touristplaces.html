<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Admin - Tourist Places</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <script src="/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Tourist Places (Admin)</h3>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTPModal">Add Tourist Place</button>
  </div>

  <form class="row g-2 mb-3" th:action="@{/admin/tourist-places}" method="get">
    <div class="col-auto">
      <input type="text" name="q" placeholder="Search name or location" class="form-control" th:value="${q}">
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-primary">Search</button>
    </div>
  </form>

  <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
  <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Location</th>
          <th>Rating</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="t : ${tpPage.content}">
          <td style="width:130px">
            <img th:src="@{'/tourist/image/' + ${t.id}}" style="width:120px;height:80px;object-fit:cover;border-radius:6px;">
          </td>

          <td th:text="${t.name}"></td>
          <td th:text="${t.location}"></td>
          <td>‚≠ê <span th:text="${t.rating}"></span></td>

          <td th:text="${#temporals.format(t.createdAt, 'dd-MMM-yyyy HH:mm')}"></td>

          <td>
            <a th:href="@{'/admin/tourist/edit/' + ${t.id}}" class="btn btn-sm btn-outline-secondary">Edit</a>
            <button class="btn btn-sm btn-danger"
              data-bs-toggle="modal"
              data-bs-target="#confirmDeleteModal"
              th:attr="data-id=${t.id}, data-name=${t.name}">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav th:if="${tpPage.totalPages > 1}">
    <ul class="pagination">
      <li class="page-item" th:classappend="${tpPage.first}? 'disabled'">
        <a class="page-link" th:href="@{/admin/touristplaces(page=${tpPage.number - 1}, q=${q})}">Prev</a>
      </li>

      <li class="page-item"
          th:each="p : ${#numbers.sequence(0, tpPage.totalPages - 1)}"
          th:classappend="${p == tpPage.number}? 'active'">
        <a class="page-link" th:href="@{/admin/touristplaces(page=${p}, q=${q})}" th:text="${p + 1}"></a>
      </li>

      <li class="page-item" th:classappend="${tpPage.last}? 'disabled'">
        <a class="page-link" th:href="@{/admin/touristplaces(page=${tpPage.number + 1}, q=${q})}">Next</a>
      </li>
    </ul>
  </nav>

</div>

<!-- Add Tourist Place Modal -->
<div class="modal fade" id="addTPModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form th:action="@{/admin/tourist/add}" method="post" enctype="multipart/form-data">

        <div class="modal-header">
          <h5 class="modal-title">Add Tourist Place</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <div class="mb-3">
            <label class="form-label">Place Name</label>
            <input class="form-control" name="name" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Location</label>
            <input class="form-control" name="location" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Rating</label>
            <input type="number" step="0.1" min="0" max="5" class="form-control" name="rating" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Image</label>
            <input type="file" class="form-control" name="imageFile" accept="image/*" required>
          </div>

        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary">Add Place</button>
        </div>

      </form>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">

      <form th:action="@{/admin/tourist/delete}" method="post">

        <div class="modal-header">
          <h5 class="modal-title">Confirm Delete</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" id="deleteId" name="id">
          <p>Delete <strong id="deleteName"></strong>?</p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger">Delete</button>
        </div>

      </form>

    </div>
  </div>
</div>

<script>
var delModal = document.getElementById('confirmDeleteModal');
delModal.addEventListener('show.bs.modal', function (event) {
  var btn = event.relatedTarget;
  document.getElementById('deleteId').value = btn.getAttribute('data-id');
  document.getElementById('deleteName').textContent = btn.getAttribute('data-name');
});
</script>

</body>
</html>
