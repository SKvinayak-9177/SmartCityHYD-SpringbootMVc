<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <title>Admin - Business Venues</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <script src="/js/bootstrap.bundle.min.js"></script>
</head>

<body class="bg-light">

<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Business Venues (Admin)</h3>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBVModal">Add Venue</button>
  </div>

  <form class="row g-2 mb-3" th:action="@{/admin/business-venues}" method="get">
    <div class="col-auto">
      <input type="text" name="q" class="form-control" placeholder="Search venue or location"
             th:value="${q}">
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-primary">Search</button>
    </div>
  </form>

  <!-- Alerts -->
  <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
  <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Image</th>
          <th>Venue Name</th>
          <th>Business Type</th>
          <th>Location</th>
          <th>Start Date</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr th:each="v : ${venuePage.content}">
          <td style="width:130px">
            <img th:src="@{'/business/image/' + ${v.id}}"
                 style="width:120px;height:80px;object-fit:cover;border-radius:6px;">
          </td>

          <td th:text="${v.name}"></td>
          <td th:text="${v.businessType}"></td>
          <td th:text="${v.location}"></td>
          <td th:text="${#temporals.format(v.venueStartDate, 'dd-MMM-yyyy')}"></td>

          <td th:text="${#temporals.format(v.createdAt, 'dd-MMM-yyyy HH:mm')}"></td>

          <td>
            <a th:href="@{'/admin/business/edit/' + ${v.id}}" class="btn btn-sm btn-outline-secondary">
              Edit
            </a>
            <button class="btn btn-sm btn-danger"
              data-bs-toggle="modal"
              data-bs-target="#deleteModal"
              th:attr="data-id=${v.id}, data-name=${v.name}">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav th:if="${venuePage.totalPages > 1}">
    <ul class="pagination">

      <li class="page-item" th:classappend="${venuePage.first}? 'disabled'">
        <a class="page-link"
           th:href="@{/admin/business-venues(page=${venuePage.number - 1}, q=${q})}">Prev</a>
      </li>

      <li class="page-item"
          th:each="p : ${#numbers.sequence(0, venuePage.totalPages - 1)}"
          th:classappend="${p == venuePage.number}? 'active'">
        <a class="page-link"
           th:href="@{/admin/business-venues(page=${p}, q=${q})}"
           th:text="${p + 1}"></a>
      </li>

      <li class="page-item" th:classappend="${venuePage.last}? 'disabled'">
        <a class="page-link"
           th:href="@{/admin/business-venues(page=${venuePage.number + 1}, q=${q})}">Next</a>
      </li>

    </ul>
  </nav>

</div>

<!-- Add Venue Modal -->
<div class="modal fade" id="addBVModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <form th:action="@{/admin/business/add}" method="post" enctype="multipart/form-data">

        <div class="modal-header">
          <h5 class="modal-title">Add Business Venue</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <div class="mb-3">
            <label class="form-label">Venue Name</label>
            <input class="form-control" name="name" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Business Type</label>
            <input class="form-control" name="businessType" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Location</label>
            <input class="form-control" name="location" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Start Date</label>
            <input type="date" class="form-control" name="venueStartDate">
          </div>

          <div class="mb-3">
            <label class="form-label">Image</label>
            <input type="file" class="form-control" name="imageFile" accept="image/*">
          </div>

        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary">Add Venue</button>
        </div>

      </form>

    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">

      <form th:action="@{/admin/business/delete}" method="post">

        <div class="modal-header">
          <h5>Delete Venue</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" id="deleteId" name="id">
          <p>Delete <strong id="deleteName"></strong>?</p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger">Delete</button>
        </div>

      </form>

    </div>
  </div>
</div>

<script>
var delModal = document.getElementById('deleteModal');
delModal.addEventListener('show.bs.modal', function (event) {
  var btn = event.relatedTarget;
  document.getElementById('deleteId').value = btn.getAttribute('data-id');
  document.getElementById('deleteName').textContent = btn.getAttribute('data-name');
});
</script>

</body>
</html>
