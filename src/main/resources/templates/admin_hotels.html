<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Admin - Hotels</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <script src="/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Hotels (Admin)</h3>

    <!-- Add Hotel button triggers modal -->
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addHotelModal">Add Hotel</button>
  </div>

  <!-- Search -->
  <form class="row g-2 mb-3" th:action="@{/admin/hotels}" method="get">
    <div class="col-auto">
      <input type="text" name="q" placeholder="Search name or location" class="form-control" th:value="${q}">
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-primary">Search</button>
    </div>
  </form>

  <!-- Alerts for success/errors -->
  <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
  <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

  <!-- Table of hotels -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Location</th>
          <th>Rating</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="h : ${hotelsPage.content}">
          <td style="width:130px">
            <img th:src="@{'/hotel/image/' + ${h.id}}" style="width:120px;height:80px;object-fit:cover;border-radius:6px;">
          </td>
          <td th:text="${h.name}"></td>
          <td th:text="${h.location}"></td>
          <td>‚≠ê <span th:text="${h.rating}"></span></td>
          <td th:text="${#temporals.format(h.createdAt, 'dd-MMM-yyyy HH:mm')}"></td>
          <td>
            <a th:href="@{'/admin/hotels/edit/' + ${h.id}}" class="btn btn-sm btn-outline-secondary">Edit</a>

            <!-- Delete button triggers confirm modal and passes id -->
            <button class="btn btn-sm btn-danger" data-bs-toggle="modal"
                    data-bs-target="#confirmDeleteModal" 
                    th:attr="data-id=${h.id}, data-name=${h.name}">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav th:if="${hotelsPage.totalPages > 1}">
    <ul class="pagination">
      <li class="page-item" th:classappend="${hotelsPage.first}? 'disabled'">
        <a class="page-link" th:href="@{/admin/hotels(page=${hotelsPage.number - 1}, q=${q})}">Prev</a>
      </li>
      <li class="page-item" th:each="p : ${#numbers.sequence(0, hotelsPage.totalPages - 1)}"
          th:classappend="${p == hotelsPage.number}? 'active'">
        <a class="page-link" th:href="@{/admin/hotels(page=${p}, q=${q})}" th:text="${p + 1}"></a>
      </li>
      <li class="page-item" th:classappend="${hotelsPage.last}? 'disabled'">
        <a class="page-link" th:href="@{/admin/hotels(page=${hotelsPage.number + 1}, q=${q})}">Next</a>
      </li>
    </ul>
  </nav>

</div>

<!-- Add Hotel Modal -->
<div class="modal fade" id="addHotelModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form th:action="@{/admin/hotels/add}" method="post" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title">Add Hotel</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input class="form-control" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Location</label>
            <input class="form-control" name="location" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Rating</label>
            <input type="number" step="0.1" max="5" min="0" class="form-control" name="rating" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Image</label>
            <input type="file" class="form-control" name="imageFile" accept="image/*" required>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Hotel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <form th:action="@{/admin/hotels/delete}" method="post">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Delete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" id="deleteHotelId">
          <p>Delete <strong id="deleteHotelName"></strong> ? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // fill confirm modal with dataset attributes
  var confirmDeleteModal = document.getElementById('confirmDeleteModal');
  confirmDeleteModal.addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget;
    var id = button.getAttribute('data-id');
    var name = button.getAttribute('data-name');
    document.getElementById('deleteHotelId').value = id;
    document.getElementById('deleteHotelName').textContent = name;
  });
</script>

</body>
</html>
