<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Admin - Restaurants</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <script src="/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Restaurants (Admin)</h3>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRestaurantModal">Add Restaurant</button>
  </div>

  <!-- Search -->
  <form class="row g-2 mb-3" th:action="@{/admin/restaurants}" method="get">
    <div class="col-auto">
      <input type="text" name="q" placeholder="Search name or location" class="form-control" th:value="${q}">
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-primary">Search</button>
    </div>
  </form>

  <!-- Alerts -->
  <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
  <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Location</th>
          <th>Rating</th>
          <th>Timings</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="r : ${restaurantsPage.content}">
          <td style="width:130px">
            <img th:src="@{'/restaurant/image/' + ${r.id}}" style="width:120px;height:80px;object-fit:cover;border-radius:6px;">
          </td>
          <td th:text="${r.name}"></td>
          <td th:text="${r.location}"></td>
          <td>‚≠ê <span th:text="${r.rating}"></span></td>
          <td th:text="${r.timings}"></td>
          <td th:text="${#temporals.format(r.createdAt, 'dd-MMM-yyyy HH:mm')}"></td>
          <td>
            <a th:href="@{'/admin/restaurants/edit/' + ${r.id}}" class="btn btn-sm btn-outline-secondary">Edit</a>
            <button class="btn btn-sm btn-danger"
                    data-bs-toggle="modal"
                    data-bs-target="#confirmDeleteModal"
                    th:attr="data-id=${r.id}, data-name=${r.name}">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav th:if="${restaurantsPage.totalPages > 1}">
    <ul class="pagination">
      <li class="page-item" th:classappend="${restaurantsPage.first}? 'disabled'">
        <a class="page-link" th:href="@{/admin/restaurants(page=${restaurantsPage.number - 1}, q=${q})}">Prev</a>
      </li>
      <li class="page-item"
          th:each="p : ${#numbers.sequence(0, restaurantsPage.totalPages - 1)}"
          th:classappend="${p == restaurantsPage.number}? 'active'">
        <a class="page-link" th:href="@{/admin/restaurants(page=${p}, q=${q})}" th:text="${p + 1}"></a>
      </li>
      <li class="page-item" th:classappend="${restaurantsPage.last}? 'disabled'">
        <a class="page-link" th:href="@{/admin/restaurants(page=${restaurantsPage.number + 1}, q=${q})}">Next</a>
      </li>
    </ul>
  </nav>

</div>

<!-- Add Restaurant Modal -->
<div class="modal fade" id="addRestaurantModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form th:action="@{/admin/restaurants/add}" method="post" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title">Add Restaurant</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input class="form-control" name="name" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Location</label>
            <input class="form-control" name="location" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Rating</label>
            <input type="number" step="0.1" min="0" max="5" class="form-control" name="rating" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Timings</label>
            <input class="form-control" name="timings" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Image</label>
            <input type="file" class="form-control" name="imageFile" accept="image/*" required>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
          <button class="btn btn-primary" type="submit">Add Restaurant</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <form th:action="@{/admin/restaurants/delete}" method="post">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Delete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" name="id" id="deleteId">
          <p>Delete <strong id="deleteName"></strong> ?</p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
          <button class="btn btn-danger" type="submit">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  var delModal = document.getElementById('confirmDeleteModal');
  delModal.addEventListener('show.bs.modal', function (event) {
    var btn = event.relatedTarget;
    document.getElementById('deleteId').value = btn.getAttribute('data-id');
    document.getElementById('deleteName').textContent = btn.getAttribute('data-name');
  });
</script>

</body>
</html>
